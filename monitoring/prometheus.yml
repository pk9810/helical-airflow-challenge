global:
  scrape_interval: 15s
  scrape_timeout: 10s
  evaluation_interval: 15s

scrape_configs:

  # -------------------------------------------------------
  # Scrape Prometheus itself
  # -------------------------------------------------------
  - job_name: "prometheus"
    static_configs:
      - targets: ["prometheus:9090"]

  # -------------------------------------------------------
  # Airflow → StatsD Exporter → Prometheus
  #
  # IMPORTANT:
  # statsd-exporter exposes metrics on HTTP /metrics at port 9102
  # -------------------------------------------------------
  - job_name: "airflow-statsd"
    metrics_path: /metrics
    static_configs:
      - targets: ["statsd-exporter:9102"]
        labels:
          service: "airflow"

    # Optional: Clean up StatsD metric names
    relabel_configs:
      # Replace dots with underscores for nicer PromQL usage
      - source_labels: [__name__]
        regex: "(.+)"
        target_label: "__name__"
        replacement: "${1}"
        action: replace

  # -------------------------------------------------------
  # Container-level metrics via cAdvisor
  # -------------------------------------------------------
  - job_name: "cadvisor"
    metrics_path: /metrics
    static_configs:
      - targets: ["cadvisor:8080"]
        labels:
          service: "containers"
